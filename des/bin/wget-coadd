#!/bin/bash
# Download DES coadd images and catalogs for a given run and band.
# Data will be copied to $DESDATA/red/${red_run}/red and $DESDATA
# must be set.

function usage_and_exit {
    echo "usage: wget-red coadd_run band"
    exit 45
}

if [[ $# -lt 2 ]]; then
    usage_and_exit
fi
if [[ ${DESDATA:+1} == "" ]]; then
    echo "The DESDATA environment variable must be set"
    exit 45
fi

coadd_run="$1"
band="$2"

echo "
downloading:
    coadd run: ${coadd_run}
    band:      ${band}
    DESDATA:   ${DESDATA}
"

echo "chdir to DESDATA dir $DESDATA"
cd $DESDATA
if [[ "$?" != "0" ]]; then
    echo "Failed to chdir to DESDATA: $DESDATA"
    exit 45
fi

# No following slash on URL or it won't work!
# use -nv for non-verbose 
wget                        \
    -c                      \
    --mirror                \
    --progress=dot:mega     \
    -nH                     \
    --cut-dirs=3            \
    --no-parent             \
    --tries 50              \
    --accept "*${band}.fits.fz,*${band}_cat.fits" \
    ftp://desar.cosmology.illinois.edu/DESFiles/desardata/DES/coadd/${coadd_run}/coadd
