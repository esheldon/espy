#!/usr/bin/env python
from __future__ import print_function
import sys
import sersic_gmix
import esutil as eu

import pickle

def main():

    ngauss=int(sys.argv[1])
    nvals=sys.argv[2:]

    nvals=[float(n) for n in nvals]

    fnames=['sersic-%.2f-ngauss-%d-fit.fits' % (n,ngauss) for n in nvals]

    data=eu.io.read(fnames,combine=True)
    data=renorm(data)
    nvals=numpy.array(nvals)

    T_splines=sersic_gmix.spline_fitting.fit_spline(data, nvals, 'T')
    flux_splines=sersic_gmix.spline_fitting.fit_spline(data, nvals, 'flux')

    splines={'T_splines':T_splines,
             'flux_splines':flux_splines}

    pfile='sersic-ngauss-%d-splines.pickle' % % ngauss

    print(pfile)
    with open(pfile,'w') as fobj:
        pickle.dump(splines, fobj)

main()
