#!/bin/bash

function usage_and_exit {
    echo "usage: wget-red coadd_run band"
    exit 45
}

if [[ $# -lt 2 ]]; then
    usage_and_exit
fi

coadd_run="$1"
band="$2"

echo "
downloading:
    coadd run: ${coadd_run}
    band:    ${band}
"

echo "changing to DESDATA dir $DESDATA"
cd $DESDATA
if [[ "$?" != "0" ]]; then
    echo "Failed to chdir to DESDATA: $DESDATA"
    exit 45
fi

# No following slash on URL or it won't work!
# use -nv for non-verbose 
wget                        \
    -c                      \
    --mirror                \
    --progress=dot:mega     \
    -nH                     \
    --cut-dirs=3            \
    --no-parent             \
    --tries 50              \
    --accept "*${band}.fits.fz,*${band}_cat.fits" \
    ftp://desar.cosmology.illinois.edu/DESFiles/desardata/DES/coadd/${coadd_run}/coadd
